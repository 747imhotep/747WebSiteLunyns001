<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="UTF-8">
  <title>Secure Download</title>
  <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.5.0/css/all.min.css">
  <link rel="stylesheet" href="/DOWNLERCSS/downloader.css">
  <link  rel="icon" href="/IMAGEDO/Favicon/Favicon-01.png">
</head>


  <body>
    <h2 class="officer">Secure Document Download</h2>

    <div id="emailPrompt" class="email-form">
      <p style="font-weight: 600;">Please enter your email to verify your identity:</p>
      <input type="email" id="email" placeholder="you@example.com" required>
      <button onclick="verifyEmail()">Check</button>
    </div>
    <div id="emailError" class="error-message hidden"></div>
    <button onclick="console.log('Check button clicked'); verifyEmail()">Check</button>


    <div id="downloadInstructions" class="informer">
        <h3>Instructions:</h3>
        <p>This is a test</p>
        <p>To access the documents, please verify your email first.</p>
        <p>Once verified, you will be able to download the documents securely.</p>
        <p>Ensure you have a stable internet connection for the download process.</p>
        <p>For any issues, please contact support.</p>
        <p>Thank you for your cooperation.</p>
        <p>Stay safe and secure!</p>
      </div>

<p id="confirmation" class="hidden" style="color: green; margin-top: 20px;"></p>


    <section id="downloadDocuments" class="downloadDocuments">
    <div class="download-item hidden">
      <img src="/IMAGEDO/DownloadFlag/Doc1.png" alt="Download Document" class="download-image">
      <p class="download-text">Click the button below to download your document.</p>
      <button class="download-btn" onclick="downloadDoc('doc1.pdf')"><i class="fas fa-file-download"></i> Download Doc 1</button>
    </div>

    <div class="download-item hidden">
      <img src="/IMAGEDO/DownloadFlag/Doc2.png" alt="Download Document" class="download-image">
      <p class="download-text">Click the button below to download your document.</p>
      <button class="download-btn" onclick="downloadDoc('doc2.pdf')"><i class="fas fa-file-download"></i> Download Doc 2</button>
    </div>

    <div class="download-item hidden">
      <img src="/IMAGEDO/DownloadFlag/Doc3.png" alt="Download Document" class="download-image">
      <p class="download-text">Click the button below to download your document.</p>
      <button class="download-btn" onclick="downloadDoc('doc3.pdf')"><i class="fas fa-file-download"></i> Download Doc 3</button>
    </div>

    <div class="download-item hidden">
      <img src="/IMAGEDO/DownloadFlag/Doc4.png" alt="Download Document" class="download-image">
      <p class="download-text">Click the button below to download your document.</p>
      <button class="download-btn" onclick="downloadDoc('doc4.pdf')"><i class="fas fa-file-download"></i> Download Doc 4</button>
    </div>
  </section>


    

    
<!------------------------------------------------------------------------------------------------>
      <script>
      console.log("Script loaded!");  // ✅ Debug line
      let verifiedEmail = '';
      let lastDownloadTime = 0;
      const downloadCooldown = 10000; // 10 seconds


      function verifyEmail() {
      const emailInput = document.getElementById("email");
      const email = emailInput.value.trim();
      const errorBox = document.getElementById("emailError");

    if (!email || !validateEmail(email)) {
      console.log("Invalid email format!");
      errorBox.textContent = "⚠️ Please enter a valid email.";
      errorBox.classList.remove("hidden");
      return;
    } else {
      console.log("Email is valid.");
      errorBox.classList.add("hidden");
    }


      verifiedEmail = email;
      console.log("Verified email set to:", verifiedEmail);

// Hide email prompt and show download UI
      document.getElementById("emailPrompt").classList.add("hidden");
      document.getElementById("downloadInstructions").classList.remove("hidden");
      document.querySelectorAll('.download-item').forEach(el => {
      el.classList.remove('hidden');
      el.classList.add('show');
    });
      }

      function validateEmail(email) {
        const re = /^[^\s@]+@[^\s@]+\.[^\s@]+$/;
        return re.test(email);
      }

      function downloadDoc(fileName) {
        const now = Date.now();
        if (now - lastDownloadTime < downloadCooldown) {
          alert("⏳ Please wait a few seconds before downloading again.");
          return;
        } 

        // Safety check
        if (!verifiedEmail) {
          alert("Please verify your email before downloading.");
          return;
        }

        lastDownloadTime = now;


// Dynamically rename file with user's email
        const sanitizedEmail = verifiedEmail.replace(/[^a-z0-9]/gi, '_').toLowerCase();
        const dynamicName = `Document_${sanitizedEmail}_${fileName}`;

        const downloadLink = document.createElement("a");
        downloadLink.href = `./DownloadDoc/${fileName}`;
        downloadLink.download = dynamicName;
        document.body.appendChild(downloadLink);
        downloadLink.click();
        document.body.removeChild(downloadLink);

        // Show confirmation
        const confirmation = document.getElementById("confirmation");
        confirmation.textContent = `✅ ${dynamicName} has been downloaded.`;
        confirmation.classList.add("hidden");
        confirmation.classList.remove("show");

        // Optional: Hide after 5 seconds
        setTimeout(() => {
          confirmation.classList.remove("hidden");
        }, 5000);
      }
    </script>
  </body>
</html>
