<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="UTF-8">
  <title>Secure Download</title>
  <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.5.0/css/all.min.css">
  <link rel="stylesheet" href="/DOWNLERCSS/downloader.css">
  <link  rel="icon" href="/IMAGEDO/Favicon/Favicon-01.png">
</head>


  <body>
    <h2 class="officer">Secure Document Download</h2>

    <div id="emailPrompt" class="email-form">
      <p style="font-weight: 600;">Please enter your email to verify your identity:</p>
      <input type="email" id="email" placeholder="you@example.com" required>
      <button onclick="verifyEmail()">Check</button>
    </div>
    <div id="emailError" class="error-message hidden"></div>
    
<!-- Contact form (hidden by default) -->
    <div id="contactForm" class="hidden">
      <h3>Request Access</h3>
      <p>Please complete the form to request download authorization.</p>
      <form id="requestForm">
        <label for="requestName">Your Name:</label>
        <input type="text" id="requestName" required>

        <label for="requestEmail">Your Email:</label>
        <input type="email" id="requestEmail" required>

        <label for="message">Message:</label>
        <textarea id="message" rows="4" required>I'd like access to the download section.</textarea>

        <button type="submit">Send Request</button>
      </form>
    </div>
<!-- Contact form END) -->


<!-- Instructions block -->
    <div id="downloadInstructions arrowIndicator" class="informer">
        <h3>Instructions:</h3>
        <p>To access the documents, please verify your email first.</p>
        <p>Once verified, you will be able to download the documents securely.</p>
        <p>Ensure you have a stable internet connection for the download process.</p>
        <p>For any issues, please contact support.</p>
        <p>Thank you for your cooperation.</p>
        <p>Stay safe and secure!</p>
      </div>



<!-- Arrow indicator -->
    <div id="arrowIndicator" class="arrow-indicator">⬇️</div>

    <div id="downloadInstructions" class="hidden">
      <div class="confirmation" id="confirmation"></div>
      <p id="confirmation" class="hidden" style="color: green; margin-top: 20px;"></p>
    </div>

<!-- Return button -->
   <div>
  <button id="returnHomeBtn" class="download-btn hidden" onclick="window.location.href='/index.html'">
    Return to HOME
  </button>
  </div>




    <section id="downloadswrapper" class="downloadDocuments download-highlight">
    <div class="download-item hidden">
      <img src="/IMAGEDO/DownloadFlag/Doc1.png" alt="Download Document" class="download-image">
      <p class="download-text">Click the button below to download your document.</p>
      <button class="download-btn" onclick="downloadDoc('doc1.pdf')"><i class="fas fa-file-download"></i> Download Doc 1</button>
    </div>

    <div class="download-item hidden">
      <img src="/IMAGEDO/DownloadFlag/Doc2.png" alt="Download Document" class="download-image">
      <p class="download-text">Click the button below to download your document.</p>
      <button class="download-btn" onclick="downloadDoc('doc2.pdf')"><i class="fas fa-file-download"></i> Download Doc 2</button>
    </div>

    <div class="download-item hidden">
      <img src="/IMAGEDO/DownloadFlag/Doc3.png" alt="Download Document" class="download-image">
      <p class="download-text">Click the button below to download your document.</p>
      <button class="download-btn" onclick="downloadDoc('doc3.pdf')"><i class="fas fa-file-download"></i> Download Doc 3</button>
    </div>

    <div class="download-item hidden">
      <img src="/IMAGEDO/DownloadFlag/Doc4.png" alt="Download Document" class="download-image">
      <p class="download-text">Click the button below to download your document.</p>
      <button class="download-btn" onclick="downloadDoc('doc4.pdf')"><i class="fas fa-file-download"></i> Download Doc 4</button>
    </div>
  </section>

  <div id="contactForm" class="hidden">
  <h3>Contact Us for Access</h3>
  <p>Please fill in the form below to request the document you need.</p>
  <form id="requestForm">
    <label for="requestName">Your Name:</label>
    <input type="text" id="requestName" name="requestName" required>

    <label for="requestEmail">Your Email:</label>
    <input type="email" id="requestEmail" name="requestEmail" required>

    <label for="message">Message:</label>
    <textarea id="message" name="message" rows="4" required></textarea>

    <button type="submit">Submit Request</button>
  </form>
</div>


  


    



    
<!------------------------------------------------------------------------------------------------>
    <script>
      console.log("Script loaded!");  // ✅ Debug line

      let verifiedEmail = '';
      let lastDownloadTime = 0;
      const downloadCooldown = 10000; // 10 seconds

      function verifyEmail() {
        const emailInput = document.getElementById("email");
        const email = emailInput.value.trim().toLowerCase;
        const errorBox = document.getElementById("emailError");

        // Validate email
        if (!email || !validateEmail(email)) {
          console.log("Invalid email format!");
          errorBox.textContent = "⚠️ Please enter a valid email.";
          errorBox.classList.remove("hidden");
          return;
        } else {
          console.log("Email is valid.");
          errorBox.classList.add("hidden");
        }

        // Check if email is authorize
        if(!authorizedEmails.includes(email)) {
          alert("Please contact us to obtain authorization to download a specific document.");
          document.getElementById("contactForm").classList.remove("hidden");
          document.getElementById("requestEmail").value = email; //auto-fill
          return
        }

        // ✅ Email is authorized
        verifiedEmail = email;

        // Save email
        verifiedEmail = email;
        console.log("Verified email set to:", verifiedEmail);

        // Show download area
        document.getElementById("emailPrompt").classList.add("hidden");
        document.getElementById("downloadInstructions").classList.remove("hidden");

        document.querySelectorAll('.download-item').forEach(el => {
          el.classList.remove('hidden');
          el.classList.add('show');
        });

        // Animate box
        const wrapper = document.getElementById("downloadwrapper");
        wrapper.classList.add("download-verified");

        // Scroll and show arrow
        const arrow = document.getElementById("arrowIndicator");
        arrow.classList.remove("hidden");
        wrapper.scrollIntoView({ behavior: 'smooth'});

        // Hide arrow & instruction after timeout
        setTimeout(() => {
          arrow.classList.add("hidden");
          document.getElementById("downloadInstructions").classList.add("hidden");
        }, 5000);

        // ✅ Restart green animation
        const wrapper = document.getElementById("downloadswrapper");
        wrapper.classList.remove("download-highlight");
        void wrapper.offsetWidth; // Force reflow
        wrapper.classList.add("download-verified");

        // ✅ Show arrow indicator
        const arrow = document.getElementById("arrowIndicator");
        arrow.classList.remove("hidden");

        // ✅ Scroll into view
        wrapper.scrollIntoView({ behavior: 'smooth' });
        

        // ✅ Hide arrow after 5 seconds
        setTimeout(() => {
          arrow.classList.add("hidden");
        }, 5000);
      }

      function validateEmail(email) {
        const re = /^[^\s@]+@[^\s@]+\.[^\s@]+$/;
        return re.test(email);
      }

      function downloadDoc(fileName) {
        const now = Date.now();
        if (now - lastDownloadTime < downloadCooldown) {
          alert("⏳ Please wait a few seconds before downloading again.");
          return;
        }}

        if (!verifiedEmail) {
          alert("Please verify your email before downloading.");
          return;
        }

        function triggerDownload(fileName) {
          const now = new Date();
          lastDownloadTime = now;

        if (!verifiedEmail){
          console.error("Verified email is not set.");
          return;
        }

          const sanitizedEmail = verifiedEmail.replace(/[^a-z0-9]/gi, '_').toLowerCase();
          const dynamicName = `Document_${sanitizedEmail}_${fileName}`;

          const downloadLink = document.createElement("a");
          downloadLink.href = `./DownloadDoc/${fileName}`;
          downloadLink.download = dynamicName;
          document.body.appendChild(downloadLink);
          downloadLink.click();
          document.body.removeChild(downloadLink);

          const confirmation = document.getElementById("confirmation");
          confirmation.textContent = `✅ ${dynamicName} has been downloaded.`;
          confirmation.classList.remove("hidden");
          confirmation.classList.add("show");

          document.getElementById("returnHomeBtn").classList.remove("hidden");

          setTimeout(() => {
            confirmation.classList.add("hidden");
          }, 5000);

          document.getElementById("downloadswrapper").classList.remove("download-highlight");
        }


      // For better security, you’ll want to replace this later 
      // with a server-side check (e.g., via API or database).
        const authorizedEmails = [
          "user1@example.com",
          "paul@example.com",
          "trusted.person@yourdomain.com",
          "manager@company.org",
          "support@lunyns.com",
          "lunywholesaler@yahoo.com",
          "soundiata@lunyns.com",
          "contact@lunyns.com",
          "sonia.nyimi@gmail.com"
        ];

    </script>

  </body>
</html>
